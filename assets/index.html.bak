<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload</title>
</head>
<body>
<h1>File Upload</h1>

<input type="file" id="fileInput" />
<button onclick="uploadFile()">upload</button>

<div id="response"></div>

<div>
    <ul id="file_list">
        <!-- Existing list items will be displayed here -->
    </ul>
</div>

<script>
    function uploadFile() {
        var fileInput = document.getElementById('fileInput');
        var file = fileInput.files[0];

        if (file) {
            var formData = new FormData();
            formData.append('file', file);

            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        // Successful upload
                        console.log(xhr)
                        filejson = JSON.parse(xhr.response)
                        if (filejson.code === 0){
                            console.log('成功了哦')
                            if (filejson.data){
                                for (var item of  filejson.data){
                                    addItem(item)
                                }
                                document.getElementById('response').innerHTML = "sucess";
                            }
                        }else{
                            console.log('失败了',filejson.msg)
                        }
                        //document.getElementById('response').innerHTML = xhr.response;
                    } else {
                        // Failed upload
                        document.getElementById('response').innerHTML = 'File upload failed. Please try again.';
                    }
                }
            };

            // Replace 'upload.php' with the actual server-side script that handles the file upload
            xhr.open('POST', 'upload', true);
            xhr.send(formData);
        } else {
            // No file selected
            document.getElementById('response').innerHTML = 'Please select a file before uploading.';
        }
    }

    function addItem(newItem) {
        // Check if the user entered something
        var listContainer = document.getElementById("file_list");
        if (newItem !== null) {
            // Create list item
            var listItem = document.createElement("li");

            // Create download link
            var downloadLink = document.createElement("a");
            var result = newItem.size / (1000 * 1000);
            var roundedResult = result.toFixed(2);
            downloadLink.textContent = newItem.name + "(" + roundedResult + "M)";
            downloadLink.href = newItem.path;
            downloadLink.download = newItem.name;

            // Append download link to list item
            listItem.appendChild(downloadLink);

            // Append list item to list container
            listContainer.appendChild(listItem);
        } else {
            alert("Please enter a valid item.");
        }
    }

    function testAddItem() {
        json = {name:"test.txt",path:"/file/uuxia/teset.txt",size:12034}
        addItem(json)
    }
</script>
</body>
</html>
